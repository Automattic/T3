(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,r=window.wp.i18n,s=window.wp.data,n=window.wp.compose,m=window.wp.apiFetch;var l=e.n(m);const c={logoUrl:themeGardenData.logoUrl,categories:themeGardenData.categories,baseUrl:themeGardenData.baseUrl,themes:themeGardenData.themes,selectedCategory:themeGardenData.selectedCategory,search:themeGardenData.search,selectedThemeId:themeGardenData.selectedThemeId,themeDetails:themeGardenData.themeDetails,isFetchingThemes:!1,isOverlayOpen:!!themeGardenData.selectedThemeId,isFetchingTheme:!1},h={closeOverlay:()=>({type:"CLOSE_OVERLAY"}),receiveTheme:(e,t)=>({type:"RECEIVE_THEME",theme:e,id:t}),receiveThemes:(e,t,a)=>({type:"RECEIVE_THEMES",themes:e,category:t,search:a}),beforeFetchTheme:()=>({type:"BEFORE_FETCH_THEME"}),beforeFetchThemes:()=>({type:"BEFORE_FETCH_THEMES"}),*fetchThemes(e){try{return i.FETCH_THEMES(e)}catch(e){throw new Error("Failed to fetch themes")}},*searchThemes(e){try{return i.SEARCH_THEMES(e)}catch(e){throw new Error("Failed to search themes")}},*fetchTheme(e){try{return i.FETCH_THEME(e)}catch(e){throw new Error("Failed to fetch theme")}}},o={getBaseUrl:()=>c.baseUrl,getCategories:()=>c.categories,getLogoUrl:()=>c.logoUrl,getSelectedCategory:e=>e.selectedCategory,getSearch:e=>e.search,getIsFetchingThemes:e=>e.isFetchingThemes,getIsFetchingTheme:e=>e.isFetchingTheme,getThemes:e=>e.themes,getIsOverlayOpen:e=>e.isOverlayOpen,getThemeDetails:e=>e.themeDetails},i={FETCH_THEMES:e=>l()({path:"/tumblr3/v1/themes?category="+e,method:"GET"}).then((e=>e)).catch((e=>{throw e})),SEARCH_THEMES:e=>l()({path:"/tumblr3/v1/themes?search="+e,method:"GET"}).then((e=>e)).catch((e=>{throw console.error("API Error:",e),e})),FETCH_THEME:e=>l()({path:"/tumblr3/v1/theme?theme="+e,method:"GET"}).then((e=>e)).catch((e=>{throw console.error("API Error:",e),e}))},d=(0,s.createReduxStore)("tumblr3/theme-garden-store",{reducer:(e=c,t)=>{switch(t.type){case"BEFORE_FETCH_THEMES":return{...e,isFetchingThemes:!0};case"BEFORE_FETCH_THEME":return{...e,isFetchingTheme:!0,isOverlayOpen:!0};case"RECEIVE_THEMES":return{...e,themes:t.themes,isFetchingThemes:!1,selectedCategory:t.category,search:t.search};case"RECEIVE_THEME":return{...e,isFetchingTheme:!1,themeDetails:t.theme,selectedThemeId:t.id};case"CLOSE_OVERLAY":return{...e,isOverlayOpen:!1,isFetchingTheme:!1,themeDetails:null};default:return e}},actions:h,selectors:o,controls:i});(0,s.register)(d);const u=(0,n.compose)((0,s.withSelect)((e=>({baseUrl:e("tumblr3/theme-garden-store").getBaseUrl(),selectedCategory:e("tumblr3/theme-garden-store").getSelectedCategory(),categories:e("tumblr3/theme-garden-store").getCategories(),search:e("tumblr3/theme-garden-store").getSearch(),themes:e("tumblr3/theme-garden-store").getThemes()}))))((({baseUrl:e,selectedCategory:s,categories:n,search:m,themes:l,fetchThemesByQuery:c,fetchThemesByCategory:h})=>{const[o,i]=(0,a.useState)(s),[d,u]=(0,a.useState)(m),[g,E]=(0,a.useState)(l),w=(0,a.useRef)();return(0,a.useEffect)((()=>{E(l)}),[l]),(0,a.useEffect)((()=>{i(s)}),[s]),(0,a.useEffect)((()=>{u(m)}),[m]),(0,t.createElement)("div",{className:"wp-filter"},(0,t.createElement)("div",{className:"filter-count"},(0,t.createElement)("span",{className:"count"},g.length)),(0,t.createElement)("label",{htmlFor:"t3-categories"},(0,r._x)("Categories","label for a dropdown list of theme categories","tumblr3")),(0,t.createElement)("select",{id:"t3-categories",name:"category",onChange:async({currentTarget:t})=>{const a=t.value;i(a),await h(a),window.history.pushState({},"",e+"&category="+a)}},(0,t.createElement)("option",{value:"featured"},(0,r._x)("Featured","The name of a category in a list of categories.","tumblr3")),n.map((e=>(0,t.createElement)("option",{key:e.text_key,value:e.text_key,selected:o===e.text_key},e.name)))),(0,t.createElement)("p",{className:"search-box"},(0,t.createElement)("label",{htmlFor:"wp-filter-search-input"},(0,r._x)("Search Themes","label for a text input","tumblr3")),(0,t.createElement)("input",{type:"search","aria-describedby":"live-search-desc",id:"wp-filter-search-input",className:"wp-filter-search",name:"search",value:d,onChange:async({currentTarget:t})=>{const a=t.value;u(a),clearTimeout(w.current),w.current=setTimeout((async()=>{await c(a),window.history.pushState({},"",e+"&search="+a)}),500)}})))})),g=()=>{const e=[(0,r._x)("Sadly, nothing.","The message displayed when no themes were found.","tumblr3"),(0,r._x)("Tragically, nothing.","The message displayed when no themes were found.","tumblr3"),(0,r._x)("We found nothing. Here it isn’t.","The message displayed when no themes were found.","tumblr3"),(0,r._x)("Couldn’t find that. Please, don’t be upset. Please.","The message displayed when no themes were found.","tumblr3"),(0,r._x)("Sincerely, we found nothing.","The message displayed when no themes were found.","tumblr3"),(0,r._x)("Nothing to see here.","The message displayed when no themes were found.","tumblr3"),(0,r._x)("If you were looking for nothing, congrats, you found it.","The message displayed when no themes were found.","tumblr3")],a=Math.floor(Math.random()*e.length);return(0,t.createElement)("p",{className:"no-themes",id:"tumblr-no-themes"},e[a])},E=(0,n.compose)((0,s.withSelect)((e=>({themes:e("tumblr3/theme-garden-store").getThemes(),isFetchingThemes:e("tumblr3/theme-garden-store").getIsFetchingThemes()}))),(0,s.withDispatch)((e=>({receiveTheme:(t,a)=>e("tumblr3/theme-garden-store").receiveTheme(t,a),beforeFetchTheme:()=>e("tumblr3/theme-garden-store").beforeFetchTheme(),fetchTheme:t=>e("tumblr3/theme-garden-store").fetchTheme(t),closeOverlay:()=>e("tumblr3/theme-garden-store").closeOverlay()}))))((({themes:e,isFetchingThemes:s,receiveTheme:n,fetchTheme:m,beforeFetchTheme:l,closeOverlay:c})=>{const[h,o]=(0,a.useState)(e);(0,a.useEffect)((()=>{o(e)}),[e]),(0,a.useEffect)((()=>(window.addEventListener("popstate",i),()=>{window.removeEventListener("popstate",i)})),[]);const i=async()=>{const e=new URLSearchParams(window.location.search).get("theme")||"";if(""!==e){l();const t=await m(e);n(t,e)}else c()},d=async({currentTarget:e})=>{const t=new URL(window.location.href),a=new URLSearchParams(t.search),r=e.value;a.append("theme",r),t.search=a.toString(),l();const s=await m(r);n(s,r),window.history.pushState({},"",t.toString())};return s?(0,t.createElement)("div",{className:"loading-content"},(0,t.createElement)("span",{className:"spinner"})):0===h.length?(0,t.createElement)(g,null):(0,t.createElement)("div",{className:"tumblr-themes"},e.map((e=>(0,t.createElement)("article",{className:"tumblr-theme",key:e.title},(0,t.createElement)("header",{className:"tumblr-theme-header"},(0,t.createElement)("div",{className:"tumblr-theme-title-wrapper"},(0,t.createElement)("span",{className:"tumblr-theme-title"},e.title))),(0,t.createElement)("div",{className:"tumblr-theme-content"},(0,t.createElement)("button",{className:"tumblr-theme-details",onClick:d,value:e.id},(0,t.createElement)("label",null,(0,t.createElement)("span",{className:"tumblr-theme-detail-button"},(0,r._x)("Theme details","Text on a button that will show more information about a Tumblr theme","tumblr3"))),(0,t.createElement)("img",{src:e.thumbnail,alt:""})),(0,t.createElement)("div",{className:"tumblr-theme-footer"},(0,t.createElement)("a",{className:"rainbow-button",href:e.activate_url},"Activate")))))))})),w=(0,n.compose)((0,s.withSelect)((e=>({themes:e("tumblr3/theme-garden-store").getThemes(),isOverlayOpen:e("tumblr3/theme-garden-store").getIsOverlayOpen(),isFetchingTheme:e("tumblr3/theme-garden-store").getIsFetchingTheme(),themeDetails:e("tumblr3/theme-garden-store").getThemeDetails()}))),(0,s.withDispatch)((e=>({closeOverlay:()=>e("tumblr3/theme-garden-store").closeOverlay()}))))((({themes:e,isOverlayOpen:s,isFetchingTheme:n,closeOverlay:m,themeDetails:l})=>{const c=(0,a.useCallback)((()=>n||!l?(0,t.createElement)("div",{className:"loading-content wp-clearfix"},(0,t.createElement)("span",{className:"spinner"})):(0,t.createElement)("div",{className:"theme-about wp-clearfix"},(0,t.createElement)("div",{className:"theme-screenshots"},(0,t.createElement)("div",{className:"screenshot"},(0,t.createElement)("img",{src:l.screenshots[0],alt:""}))),(0,t.createElement)("div",{className:"theme-info"},(0,t.createElement)("h2",{className:"theme-name"},l.title),(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:l.description}})))),[l,n]);return s?(0,t.createElement)("div",{className:"theme-overlay",id:"tumblr-theme-overlay"},(0,t.createElement)("div",{className:"theme-backdrop"}),(0,t.createElement)("div",{className:"theme-wrap wp-clearfix"},(0,t.createElement)("div",{className:"theme-header"},(0,t.createElement)("button",{className:"close dashicons dashicons-no",onClick:()=>{const e=new URL(window.location.href),t=new URLSearchParams(e.search);t.delete("theme"),e.search=t.toString(),window.history.pushState({},"",e.toString()),m()}},(0,t.createElement)("span",{className:"screen-reader-text"},(0,r._x)("Close theme details overlay","label for a button that will close an overlay","tumblr3")))),c())):null})),T=(0,n.compose)((0,s.withSelect)((e=>({logoUrl:e("tumblr3/theme-garden-store").getLogoUrl()}))),(0,s.withDispatch)((e=>({beforeFetchThemes:()=>e("tumblr3/theme-garden-store").beforeFetchThemes(),fetchThemes:t=>e("tumblr3/theme-garden-store").fetchThemes(t),searchThemes:t=>e("tumblr3/theme-garden-store").searchThemes(t),receiveThemes:(t,a,r)=>e("tumblr3/theme-garden-store").receiveThemes(t,a,r)}))))((({logoUrl:e,beforeFetchThemes:s,fetchThemes:n,receiveThemes:m,searchThemes:l})=>{(0,a.useEffect)((()=>(window.addEventListener("popstate",o),()=>{window.removeEventListener("popstate",o)})),[]);const c=async e=>{s();const t=await n(e);m(t,e,"")},h=async e=>{s();const t=await l(e);m(t,"",e)},o=async()=>{const e=new URLSearchParams(window.location.search),t=e.get("category")||"featured",a=e.get("search")||"";console.info("detected browser navigation"),""!==a?(console.info("fetching themes by search"),await h(a)):""!==t&&(console.info("fetching themes by category"),await c(t))};return(0,t.createElement)("div",{className:"wrap"},(0,t.createElement)("h1",{className:"wp-heading-inline",id:"theme-garden-heading"},(0,t.createElement)("img",{className:"tumblr-logo-icon",src:e,alt:""}),(0,t.createElement)("span",null,(0,r.__)("Tumblr Themes","tumblr3"))),(0,t.createElement)(u,{fetchThemesByCategory:c,fetchThemesByQuery:h}),(0,t.createElement)(E,null),(0,t.createElement)(w,null))})),b=document.getElementById("tumblr-theme-garden");b?(0,a.createRoot)(b).render((0,t.createElement)(T,null)):console.error("Failed to find the root element for the settings panel.")})();